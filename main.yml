---
   
  - name: Network
    hosts: "intRout"
    become: true
    tasks:
      - name: install iptables
        yum:
          name:
            - iptables
            - iptables-services 
      - name: create template Nat
        template:
          src: iptables
          dest: /etc/sysconfig/iptables
          owner: root
          group: root
          mode: "600"
      - name: start service iptables
        service:
          name: iptables
          state: started
          enabled: true
      
  - name: enable foward
    hosts: "all_router"
    become: true
    tasks:      
      - name: enable forwarding  
        sysctl:
          name: net.ipv4.conf.all.forwarding
          value: '1'
          state: present  
  
    
  - name:
    hosts: all
    become: true
    tasks:
      - name: disable default route
        lineinfile: 
          path: /etc/sysconfig/network-scripts/ifcfg-eth0  
          line: DEFROUTE=NO
        when: (ansible_hostname == "centRout") or 
              (ansible_hostname == "dirSer")
      - name: add default gatw centRout
        lineinfile:
          path: /etc/sysconfig/network-scripts/ifcfg-eth1
          line: GATEWAY=192.168.255.1
        when: (ansible_hostname == "centRout") 
      - name: add default gateway for dirSer
        lineinfile:
          path: /etc/sysconfig/network-scripts/ifcfg-eth1
          line: GATEWAY=192.168.0.1 
        when: (ansible_hostname == "dirSer")
      - name: set up route on off1Ser
        template:
          src: off1Ser.j2 
          dest: /etc/netplan/50-vagrant.yaml
          owner: root
          group: root
          mode: 0644
        when: (ansible_hostname == "off1Ser")
      - name: set up route on off2Ser
        template:
          src: off2Ser.j2
          dest: /etc/network/interfaces
          owner: root
          group: root
          mode: 0644
        when: (ansible_hostname == "off2Ser")
      - name: set up route on off1Rout
        template:
          src: off1Rout.j2 
          dest: /etc/netplan/50-vagrant.yaml
          owner: root
          group: root
          mode: 0644
        when: (ansible_hostname == "off1Rout")
      - name: set up route on off2Rout
        template:
          src: off2Rout.j2
          dest: /etc/network/interfaces
          owner: root
          group: root
          mode: 0644
        when: (ansible_hostname == "off2Rout")

  
  
          
          
