---
 - name: install all host
   become: true
   hosts: vm
   tasks:
     - name: add repository
       lineinfile:
         path: /etc/apt/sources.list
         line: deb https://apt.postgresql.org/pub/repos/apt bullseye-pgdg main
    
     - name: apt-key
       apt_key:
         url: https://www.postgresql.org/media/keys/ACCC4CF8.asc
         state: present

     - name: install programs
       block:
         - name: Install node1 
           apt:
             update_cache: yes
             name:
             - gnupg2
             - postgresql-16
             - psycopg2              
         - name:
           postgresql_user:
             name: replication
             password: 1qaz@WSX
             role_attr_flags: REPLICATION
             

           when: (ansible_hostname == "node1")


        
  
