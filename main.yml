---
 - name: PXE
   hosts: pxeserver
   become: true
   tasks:
     - name: change repo 
       lineinfile:
         path: "{{ item }}"
         regexp: 'mirrorlist'
         line: '#mirrorlist'
       loop:
       - /etc/yum.repos.d/CentOS-Linux-AppStream.repo
       - /etc/yum.repos.d/CentOS-Linux-BaseOS.repo
     - name: change repo
       lineinfile:
         path: /etc/yum.repos.d/CentOS-Linux-AppStream.repo
         regexp: '#baseurl'
         line: 'baseurl=http://archive.kernel.org/centos-vault/8.4.2105/AppStream/x86_64/os/'
     - name: change repo
       lineinfile:
         path: /etc/yum.repos.d/CentOS-Linux-BaseOS.repo
         regexp: '#baseurl'
         line:  'baseurl=http://archive.kernel.org/centos-vault/8.4.2105/BaseOS/x86_64/os/'
    
     - name: install programs
       yum:
         name:
           - vim
           - wget
           - epel-release
           - httpd
           - tftp-server
           - dhcp-server
         state: present
           #        update_cache: true
           #- name: Download iso Centos
           #get_url:
           # url: https://archive.kernel.org/centos-vault/8.4.2105/isos/x86_64/CentOS-8.4.2105-x86_64-dvd1.iso
           #dest: '~/CentOS-8.4.2105-x86_64-dvd1.iso'
           #mode: 0755
     - name: mount iso centos 8
       mount: 
         path: /mnt/
         src: '~/CentOS-8.4.2105-x86_64-dvd1.iso'
         fstype: iso9660
         opts: ro,loop
         state: present 
       
     - name: create directory for iso 
       file:
         path: iso/
         state: directory
         owner: root
         group: root
         mode: 0755
           
     - name: coppy iso with directory
       copy:
         src: "{{ item }}" 
         dest: iso/
         remote_src: yes    
       with_items:
         - "/mnt/"
     
           # - name: create folder for  pxe.boot
           #file:
           #path: /etc/httpd/conf.d/pxeboot.conf
           #state: touch
           #mode: 0755
     
           #- name: config pxe.boot
           # blockinfile:
           #path: /etc/httpd/conf.d/pxeboot.conf
           #block: |
           #Alias /centos8 iso/
           #<Directory iso/>
           # Options Indexes FollowSymLinks
           #Require all granted
    
     - name: restart httpd
       service:
         name: httpd
         state: restarted
         enabled: yes






  


