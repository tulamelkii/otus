 - name: install all hosts
   hosts: vm
   become: true
   tasks:
    - name: install update and program
      apt:
        update_cache: yes
        name: 
        - traceroute
        - tcpdump
        - nmap
        - frr
        - frr-pythontools
        state: latest
         
    - name: enable forwarding  
      sysctl:
        name: net.ipv4.conf.all.forwarding
        value: '1'
        state: present  

    - name: change config frr
      lineinfile:
        path: /etc/frr/daemons
        regexp: 'ospfd='
        line: 'ospfd=yes'
    - name: tamplate Rout1 frr
      template:
        src: templ_frr.conf
        dest: /etc/frr/frr.conf
        owner: frr
        group: frr
        mode: 0644
      when: (ansible_hostname == "Router1")

    - name: temp2
      template:
        src: templ_frr.conf2
        dest: /etc/frr/frr.conf
        owner: frr
        group: frr
        mode: 0644
      when: (ansible_hostname == "Router2")

    - name:
      template:
        src: templ_frr.conf3
        dest: /etc/frr/frr.conf
        owner: frr
        group: frr
        mode: 0644
      when: (ansible_hostname == "Router3")

    - name: restart
      service:
        name: frr
        state: restarted
        enabled: true

    - name: reboot all hosts
      block:
      - shell: systemctl reboot
        async: 300
        poll: 0
        ignore_errors: true

      - name: wait for system hosts
        wait_for_connection:
          delay: 60
          timeout: 300

