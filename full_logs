localadm@DEB:~/otus$ vagrant up
Bringing machine 'Server' up with 'virtualbox' provider...
Bringing machine 'Client' up with 'virtualbox' provider...
==> Server: Importing base box 'debian/bullseye64'...
==> Server: Matching MAC address for NAT networking...
==> Server: Checking if box 'debian/bullseye64' version '11.20230615.1' is up to date...
==> Server: There was a problem while downloading the metadata for your box
==> Server: to check for updates. This is not an error, since it is usually due
==> Server: to temporary network problems. This is just a warning. The problem
==> Server: encountered was:
==> Server: 
==> Server: The requested URL returned error: 404
==> Server: 
==> Server: If you want to check for box updates, verify your network connection
==> Server: is valid and try again.
==> Server: Setting the name of the VM: otus_Server_1697997479057_42477
==> Server: Clearing any previously set network interfaces...
==> Server: Preparing network interfaces based on configuration...
    Server: Adapter 1: nat
    Server: Adapter 2: intnet
    Server: Adapter 3: hostonly
==> Server: Forwarding ports...
    Server: 22 (guest) => 2222 (host) (adapter 1)
==> Server: Running 'pre-boot' VM customizations...
==> Server: Booting VM...
==> Server: Waiting for machine to boot. This may take a few minutes...
    Server: SSH address: 127.0.0.1:2222
    Server: SSH username: vagrant
    Server: SSH auth method: private key
    Server: 
    Server: Vagrant insecure key detected. Vagrant will automatically replace
    Server: this with a newly generated keypair for better security.
    Server: 
    Server: Inserting generated public key within guest...
    Server: Removing insecure key from the guest if it's present...
    Server: Key inserted! Disconnecting and reconnecting using new SSH key...
==> Server: Machine booted and ready!
==> Server: Checking for guest additions in VM...
    Server: The guest additions on this VM do not match the installed version of
    Server: VirtualBox! In most cases this is fine, but in rare cases it can
    Server: prevent things such as shared folders from working properly. If you see
    Server: shared folder errors, please make sure the guest additions within the
    Server: virtual machine match the version of VirtualBox you have installed on
    Server: your host and reload your VM.
    Server: 
    Server: Guest Additions Version: 6.0.0 r127566
    Server: VirtualBox Version: 6.1
==> Server: Setting hostname...
==> Server: Configuring and enabling network interfaces...
==> Server: Mounting shared folders...
    Server: /vagrant => /home/localadm/otus
==> Client: Importing base box 'debian/bullseye64'...
==> Client: Matching MAC address for NAT networking...
==> Client: Checking if box 'debian/bullseye64' version '11.20230615.1' is up to date...
==> Client: Setting the name of the VM: otus_Client_1697997526474_1357
==> Client: Fixed port collision for 22 => 2222. Now on port 2200.
==> Client: Clearing any previously set network interfaces...
==> Client: Preparing network interfaces based on configuration...
    Client: Adapter 1: nat
    Client: Adapter 2: intnet
    Client: Adapter 3: hostonly
==> Client: Forwarding ports...
    Client: 22 (guest) => 2200 (host) (adapter 1)
==> Client: Running 'pre-boot' VM customizations...
==> Client: Booting VM...
==> Client: Waiting for machine to boot. This may take a few minutes...
    Client: SSH address: 127.0.0.1:2200
    Client: SSH username: vagrant
    Client: SSH auth method: private key
    Client: 
    Client: Vagrant insecure key detected. Vagrant will automatically replace
    Client: this with a newly generated keypair for better security.
    Client: 
    Client: Inserting generated public key within guest...
    Client: Removing insecure key from the guest if it's present...
    Client: Key inserted! Disconnecting and reconnecting using new SSH key...
==> Client: Machine booted and ready!
==> Client: Checking for guest additions in VM...
    Client: The guest additions on this VM do not match the installed version of
    Client: VirtualBox! In most cases this is fine, but in rare cases it can
    Client: prevent things such as shared folders from working properly. If you see
    Client: shared folder errors, please make sure the guest additions within the
    Client: virtual machine match the version of VirtualBox you have installed on
    Client: your host and reload your VM.
    Client: 
    Client: Guest Additions Version: 6.0.0 r127566
    Client: VirtualBox Version: 6.1
==> Client: Setting hostname...
==> Client: Configuring and enabling network interfaces...
==> Client: Mounting shared folders...
    Client: /vagrant => /home/localadm/otus
==> Client: Running provisioner: ansible...
    Client: Running ansible-playbook...
[WARNING]: Found both group and host with same name: Client
[WARNING]: Found both group and host with same name: Server

PLAY [install all hosts] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [Client]
ok: [Server]

TASK [install update and program] **********************************************
changed: [Client]
changed: [Server]

TASK [Update NTP configuration] ************************************************
changed: [Server]
changed: [Client]

TASK [start service] ***********************************************************
ok: [Server]
ok: [Client]

TASK [generate key openvpn] ****************************************************
skipping: [Client]
changed: [Server]

TASK [create conf file openvpn] ************************************************
skipping: [Client]
ok: [Server]

TASK [create template] *********************************************************
skipping: [Client]
changed: [Server]

TASK [create file service openvpn] *********************************************
skipping: [Client]
ok: [Server]

TASK [create template service] *************************************************
skipping: [Client]
changed: [Server]

TASK [create pki dir] **********************************************************
skipping: [Client]
ok: [Server]

TASK [check folder and init pki] ***********************************************
skipping: [Client]
changed: [Server]

TASK [copy generate key for local machine] *************************************
skipping: [Client] => (item={'src': '/etc/openvpn/static.key', 'dest': 'cert/static.key'}) 
skipping: [Client] => (item={'src': '/etc/openvpn/pki/ca.crt', 'dest': 'cert/ca.crt'}) 
skipping: [Client] => (item={'src': '/etc/openvpn/pki/issued/client.crt', 'dest': 'cert/client.crt'}) 
skipping: [Client] => (item={'src': '/etc/openvpn/pki/private/client.key', 'dest': 'cert/client.key'}) 
skipping: [Client]
changed: [Server] => (item={'src': '/etc/openvpn/static.key', 'dest': 'cert/static.key'})
changed: [Server] => (item={'src': '/etc/openvpn/pki/ca.crt', 'dest': 'cert/ca.crt'})
changed: [Server] => (item={'src': '/etc/openvpn/pki/issued/client.crt', 'dest': 'cert/client.crt'})
changed: [Server] => (item={'src': '/etc/openvpn/pki/private/client.key', 'dest': 'cert/client.key'})

TASK [start service] ***********************************************************
skipping: [Client]
changed: [Server]

TASK [create file client.conf for client] **************************************
skipping: [Server]
changed: [Client]

TASK [create file] *************************************************************
skipping: [Server]
ok: [Client]

TASK [start service] ***********************************************************
skipping: [Server]
changed: [Client]

TASK [copy] ********************************************************************
skipping: [Client] => (item={'src': 'cert/static.key', 'dest': '/etc/openvpn/static.key'}) 
skipping: [Client] => (item={'src': 'cert/ca.crt', 'dest': '/ca.crt'}) 
skipping: [Client] => (item={'src': 'cert/client.crt', 'dest': '/client.crt'}) 
skipping: [Client] => (item={'src': 'cert/client.key', 'dest': '/client.key'}) 
skipping: [Client]
changed: [Server -> Client(127.0.0.1)] => (item={'src': 'cert/static.key', 'dest': '/etc/openvpn/static.key'})
changed: [Server -> Client(127.0.0.1)] => (item={'src': 'cert/ca.crt', 'dest': '/ca.crt'})
changed: [Server -> Client(127.0.0.1)] => (item={'src': 'cert/client.crt', 'dest': '/client.crt'})
changed: [Server -> Client(127.0.0.1)] => (item={'src': 'cert/client.key', 'dest': '/client.key'})

RUNNING HANDLER [restart vpn_server] *******************************************
changed: [Server]

RUNNING HANDLER [restart vpn_client] *******************************************
changed: [Client]

PLAY RECAP *********************************************************************
Client                     : ok=8    changed=5    unreachable=0    failed=0    skipped=10   rescued=0    ignored=0   
Server                     : ok=15   changed=10   unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   


==> Server: Machine 'Server' has a post `vagrant up` message. This is a message
==> Server: from the creator of the Vagrantfile, and not from Vagrant itself:
==> Server: 
==> Server: Vanilla Debian box. See https://app.vagrantup.com/debian for help and bug reports

==> Client: Machine 'Client' has a post `vagrant up` message. This is a message
==> Client: from the creator of the Vagrantfile, and not from Vagrant itself:
==> Client: 
==> Client: Vanilla Debian box. See https://app.vagrantup.com/debian for help and bug reports
